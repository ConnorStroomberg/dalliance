<!DOCTYPE html PUBLIC
	"-//W3C//DTD XHTML 1.1 plus MathML 2.0 plus SVG 1.1//EN"
	"http://www.w3.org/2002/04/xhtml-math-svg/xhtml-math-svg-flat.dtd"> 

<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:svg="http://www.w3.org/2000/svg"
     >

<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml;charset=utf-8"/>
<link rel='stylesheet' href='css/bootstrap.css'>
<link rel='stylesheet' href='css/dalliance.css'>
<title>Human NCBI36 :: Dalliance</title> 
<style>
body {font-family: 'helvetica'}
</style>
<script language="javascript" src="js/spans.js"></script>
<script language="javascript" src="js/utils.js"></script>
<script language="javascript" src="js/das.js"></script>
<script language="javascript" src="js/cbrowser.js"></script>
<script language="javascript" src="js/feature-popup.js"></script>
<script language="javascript" src="js/tier.js"></script>
<script language="javascript" src="js/sequence-tier.js"></script>
<script language="javascript" src="js/features.js"></script>
<script language="javascript" src="js/color.js"></script>
<script language="javascript" src="js/feature-draw.js"></script>
<script language="javascript" src="js/sequence-draw.js"></script>
<script language="javascript" src="js/slider.js"></script>
<script language="javascript" src="js/domui.js"></script>
<script language="javascript" src="js/karyoscape.js"></script>
<script language="javascript" src="js/quant-config.js"></script>
<script language="javascript" src="js/track-adder.js"></script>
<script language="javascript" src="js/chainset.js"></script>
<script language="javascript" src="js/version.js"></script>
<script language="javascript" src="js/sha1.js"></script>
<script language="javascript" src="js/sample.js"></script>
<script language="javascript" src="js/kspace.js"></script>
<script language="javascript" src="json/json2.js"></script>
<script language="javascript" src="js/bin.js"></script>
<script language="javascript" src="js/bigwig.js"></script>
<script language="javascript" src="js/bam.js"></script>
<script language="javascript" src="js/twoBit.js"></script>
<script language="javascript" src="js/thub.js"></script>
<script language="javascript" src="jszlib/js/inflate.js"></script>

<script language="javascript">

var NS_SVG = 'http://www.w3.org/2000/svg';
var NS_HTML = 'http://www.w3.org/1999/xhtml';
var NS_XLINK = 'http://www.w3.org/1999/xlink';


  var b = new Browser({
    chr:          '22',
    viewStart:    30000000,
    viewEnd:      30030000,
    cookieKey:    'human',

    chains: {
      hg19ToHg18: new Chainset('http://www.derkholm.net:8080/das/hg19ToHg18/', 'GRCh37', 'NCBI36',
                               {
                                  speciesName: 'Human',
                                  taxon: 9606,
                                  auth: 'GRCh',
                                  version: 37
                               })
    },

    sources:     [{name:                 'Genome',      
                   twoBitURI:            'http://www.biodalliance.org/datasets/hg18.2bit',
                   tier_type:            'sequence'},
                  {name:                 'Genes',     
                   desc:                 'Gene structures from Ensembl 54',
                   uri:                  'http://www.derkholm.net:8080/das/hsa_54_36p/',      
                   collapseSuperGroups:  true,
                   provides_karyotype:   true,
                   provides_search:      true,
                   provides_entrypoints: true,
                   maxbins:              false}, 
                  {name:                 'Repeats',     
                   uri:                  'http://www.derkholm.net:8080/das/hsa_54_36p/',      
                   stylesheet_uri:       'http://www.biodalliance.org/stylesheets/repeats-L1.xml'}, 
                  {name:                 'CpG Density', 
                   uri:                  'http://www.derkholm.net:8080/das/hg18comp/',        
                   stylesheet_uri:       'http://www.biodalliance.org/stylesheets/cpg-hist.xml'},
                  {name:                 'BWG test',
                   bwgURI:               'http://www.biodalliance.org/datasets/spermMethylation.bw',
                   stylesheet_uri:       'http://www.ebi.ac.uk/das-srv/genomicdas/das/batman_seq_SP/stylesheet'},
                  {name:                 'BBD test',
                   bwgURI:               'http://www.biodalliance.org/datasets/ensGene.bb',
                   link:                 'http://ncbi36.ensembl.org/Homo_sapiens/Gene/Summary?t=$$',
                   collapseSuperGroups:  true,
                   disable: true}],

    searchEndpoint: new DASSource('http://www.derkholm.net:8080/das/hsa_54_36p/'),
    browserLinks: {
        Ensembl: 'http://ncbi36.ensembl.org/Homo_sapiens/Location/View?r=${chr}:${start}-${end}',
        UCSC: 'http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg18&position=chr${chr}:${start}-${end}',
        Sequence: 'http://www.derkholm.net:8080/das/hg18comp/sequence?segment=${chr}:${start},${end}'
    }
  });

  b.addFeatureListener(function(ev, hit) {
    b.featurePopup(ev, hit, null);
  });

  b.addFeatureHoverListener(function(ev, hit) {
     // console.log('hover: ' + miniJSONify(hit));
  });

  function formatLongInt(n) {
    return (n|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')
  }

  b.addViewListener(function(chr, min, max) {
      document.getElementById('locfield').value = ('chr' + chr + ':' + formatLongInt(min) + '..' + formatLongInt(max));
  });

  b.addRegionSelectListener(function(chr, min, max) {
      // console.log('chr' + chr + ':' + min + '..' + max);
      // b.highlightRegion(chr, min, max);
      // console.log('selected ' + b.featuresInRegion(chr, min, max).length);
  });

  b.addTierListener(function() {
    console.log('tiers have changed');
  });

  window.addEventListener('load', function() {

    var addTrackBtn = document.getElementById('add-track-button');
    addTrackBtn.addEventListener('click', function(ev) {
      b.showTrackAdder(ev);
    }, false);
    b.makeTooltip(addTrackBtn, 'Add a track!');

    var zoomInBtn = document.getElementById('zoom-in');
    zoomInBtn.addEventListener('click', function(ev) {
      ev.stopPropagation(); ev.preventDefault();

      var oz = b.zoomSliderValue;
      b.zoomSliderValue=oz - 10;
      var nz = b.zoomSliderValue;
      if (nz != oz) {
          b.zoom(Math.exp((1.0 * nz) / b.zoomExpt));
      }
    }, false);
    b.makeTooltip(zoomInBtn, 'Zoom in');

    var zoomOutBtn = document.getElementById('zoom-out');
    zoomOutBtn.addEventListener('click', function(ev) {
      ev.stopPropagation(); ev.preventDefault();

      var oz = b.zoomSliderValue;
      b.zoomSliderValue=oz + 10;
      var nz = b.zoomSliderValue;
      if (nz != oz) {
          b.zoom(Math.exp((1.0 * nz) / b.zoomExpt));
      }
    }, false);
    b.makeTooltip(zoomOutBtn, 'Zoom out');

    var favBtn = document.getElementById('favourites-button');
    b.makeTooltip(favBtn, 'Favourite regions');

    var svgBtn = document.getElementById('export-svg-button');
    svgBtn.addEventListener('click', function(ev) {
       ev.stopPropagation(); ev.preventDefault();
  
        var saveDoc = document.implementation.createDocument(NS_SVG, 'svg', null);
        saveDoc.documentElement.setAttribute('width', 400);
        saveDoc.documentElement.setAttribute('height', 400);

        var saveRoot = makeElementNS(NS_SVG, 'g', null, {
            fontFamily: 'helvetica'
        });
        saveDoc.documentElement.appendChild(saveRoot);
        var dallianceAnchor = makeElementNS(NS_SVG, 'text', 'Graphics from Dalliance ' + VERSION, {
                x: 80,
                y: 30,
                strokeWidth: 0,
                fill: 'black',
                fontSize: '12pt'
        });
        saveRoot.appendChild(dallianceAnchor);

        var svgBlob = new Blob([new XMLSerializer().serializeToString(saveDoc)]);
        var fr = new FileReader();
        fr.onload = function(fre) {
           // console.log(fre.target.result.substring(6));
           window.open('data:image/svg+xml;' + fre.target.result.substring(6), 'Dalliance graphics');
        };
        fr.readAsDataURL(svgBlob);
        // window.location.href=svgURL;
    }, false);
    b.makeTooltip(svgBtn, 'Export publication-quality SVG');
  }, false);
</script>
</head>

<body>

<h2>Human NCBI36</h2>

<div class='btn-toolbar'>
  <div class='btn-group'>
    <input type='text' value='chr22:3000000..30010000    ' style='width: 300px; margin-bottom: 0px' ' id='locfield'></input>
  </div>
  <div class='btn-group'>
    <a class='btn' id='zoom-in' href='#'><i class='icon-zoom-in'></i></a>
    <span class='btn'><input id='zoom-slider' type='range'></input></span>
    <a class='btn' id='zoom-out' href='#'><i class='icon-zoom-out'></i></a>
  </div>

  <div class='btn-group'>
    <a class='btn' href='#' id='add-track-button'><i class='icon-plus-sign'></i></a>
    <a class='btn' href='#' id='favourites-button'><i class='icon-bookmark'></i></a>
    <a class='btn' href='#' id='export-svg-button'><i class='icon-screenshot'></i></a>
  </div>
</div>
                



<br>
<div id='svgHolder' style='overflow: hidden; display: inline-block; width: 95%; font-size: 10pt'>
</div>

<div id="log">
</div>

</body>
</html>

